<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>内容管理系统</title>
	<link rel="favicon" href="/Public/assets/images/favicon.png">
	<link rel="stylesheet" href="/Public/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="/Public/assets/css/font-awesome.min.css"> 
	<link rel="stylesheet" href="/Public/assets/css/bootstrap-theme.css" media="screen"> 
	<link rel="stylesheet" href="/Public/assets/css/style.css">
    <link rel='stylesheet' id='camera-css'  href='/Public/assets/css/camera.css' type='text/css' media='all'> 
	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
	<script src="/Public/assets/js/html5shiv.js"></script>
	<script src="/Public/assets/js/respond.min.js"></script>
	<![endif]-->
</head>
<body>
	<!-- Fixed navbar -->
	<div class="navbar navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<!-- Button for smallest screens -->
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
				<a class="navbar-brand" href="index.html">
					<img src="/Public/assets/images/logo.png" alt="Techro HTML5 template"></a>
			</div>
			<div class="navbar-collapse collapse">
				<ul class="nav navbar-nav pull-right mainNav">
					<li   ><a href="/index.php/Home/Index/index.html">首页</a></li><li   ><a href="/index.php/Home/Index/about.html">关于我们</a></li><li class="active"  ><a href="/index.php/Home/Index/classes.html">课程中心</a></li><li   ><a href="/index.php/Home/Index/contact.html">联系我们</a></li>				</ul>
			</div>
			<!--/.nav-collapse -->
		</div>
	</div>
	<!-- /.navbar -->

<header id="head" class="secondary">
    <div class="container">
        <h1>课程中心</h1>
    </div>
</header>

    
	<div id="courses">
		<section class="container">
			<div class="row">

			<!-- Article main content -->
			<article class="col-md-8 maincontent">
				<br>
				<br>
				<table style="text-align: center;" width="100%">
					<tr><td><h2>MySQL优化</h2></td></tr>
					<tr align="center"><td>
						作者：佚名&nbsp;&nbsp;&nbsp;
						分类：MySQL&nbsp;&nbsp;&nbsp;
						点击率：24&nbsp;&nbsp;&nbsp;
						发布日期：2017-01-18 00:00:00					</td></tr>
					<tr>
						<td style='text-align:left;'>
						<p><h3 style="font-size:18px;font-family:Helvetica, &quot;">
    一、基本架构
</h3>
<p style="font-size:15px;font-family:Helvetica, &quot;">
    1.服务层：处理连接 安全验证&nbsp;<br />
2.核心层：查询分析,优化,缓存,内置函数 内建试图,存储过程,触发器&nbsp;<br />
3.存储引擎：数据的存储 提取
</p>
<h3 style="font-size:18px;font-family:Helvetica, &quot;">
    二、选择版本
</h3>
<p style="font-size:15px;font-family:Helvetica, &quot;">
    MariaDB 完全兼容mysql XtraDB引擎 代替mysql的InnoDB引擎&nbsp;<br />
企业版：收费&nbsp;<br />
社区版：开源，用的人多&nbsp;<br />
Percona Server：新特性多&nbsp;<br />
MariaDB：国内用的不多
</p>
<h3 style="font-size:18px;font-family:Helvetica, &quot;">
    三、配置文件详解
</h3>
<p style="font-size:15px;font-family:Helvetica, &quot;">
    /etc/my.cnf
</p>
<ol style="font-family:Helvetica, &quot;font-size:15px;">
    <li>
        max<em>connections mysql所允许的同时会话数 报错：Too many connections
    </li>
    <li>
        max</em>connect<em>erros 最大错误允许数 报错：FLUSH HOSTS 重启服务
    </li>
    <li>
        key</em>buffer<em>size 关键词缓冲区大小 缓存MyISAM索引块 索引处理速度 读取索引处理速度
    </li>
    <li>
        max</em>allowed<em>packet设置最大包 限制server接收数据块大小 避免超长SQL执行 信息包过大 关闭连接 丢失与MySQL服务器连接报错
    </li>
    <li>
        thread</em>cache<em>size 服务器线程缓存
    </li>
    <li>
        thread</em>concurrency CPU核数×2 MySQL不能很好利用多核处理器性能
    </li>
    <li>
        sort<em>buffer</em>size 每个连接需要使用buffer时分配的内存大小 不是越大越好
    </li>
    <li>
        join<em>buffer</em>size join表使用的缓存大小
    </li>
    <li>
        query<em>cache</em>size 查询缓存大小 查询结果缓存 缓存期间表必须没有更改，否则失效 多写操作数据库设置过大，影响写入效率
    </li>
    <li>
        read<em>buffer</em>size MyISAM全表扫描缓冲大小 无法添加索引全表扫描，需要增大优化
    </li>
    <li>
        read<em>rnd</em>buffer<em>size 从排序好的数据中读取行时的，行数据从缓冲区读取 提升order by性能&nbsp;<br />
注意：mysql会为每个客户端申请这个缓冲区，并发过大，设置过大，影响开销
    </li>
    <li>
        myisam</em>sort<em>buffer</em>size：当MyISAM表发生变化时，重新排序，所需缓存
    </li>
    <li>
        innodb<em>buffer</em>pool<em>size：InnoDB 使用缓存保存索引，原始数据，缓存大小，可以有效减少读取数据所需的磁盘IO
    </li>
    <li>
        nnodb</em>log<em>file</em>size：数据日志文件大小 大的值可以提高性能，但增加了恢复故障数据库的时间
    </li>
    <li>
        innodb<em>log</em>buffer<em>size：日志文件缓存 增大该值可以提高性能，但增大了忽然宕机损失数据的风险
    </li>
    <li>
        innodb</em>flush<em>log</em>at<em>trx</em>commit：执行事务的时候，会往InnoDB存储引擎日志缓存中插入事务日志&nbsp;<br />
写数据前先预写日志的方式 ：&nbsp;<br />
0 每秒日志缓存写入文件 实时写入&nbsp;<br />
1 缓存实时写入文件，文件实时写入磁盘&nbsp;<br />
2 缓存实时写入文件，每秒日志文件写入磁盘
    </li>
    <li>
        innodb<em>lock</em>wait<em>timeout：被回滚前，一个InnoDB事务，应该等待一个锁被批准多久，InnoDB无法检测死锁发生，这时候用这个值有效&nbsp;<br />
《高性能MySQL》
    </li>
</ol>
<h3 style="font-size:18px;font-family:Helvetica, &quot;">
    四、软件优化
</h3>
<ol style="font-family:Helvetica, &quot;font-size:15px;">
    <li>
        选合适的引擎&nbsp;<br />
a. MyISAM 索引顺序访问方法 支持全文索引 非事务安全 不支持外键 表级锁&nbsp;<br />
三个文件FRM文件存放表结构 MYD文件存放数据 MYI存放索引&nbsp;<br />
b. InnoDB 事务性存书引擎 行锁 InnoDB 回滚 崩溃恢复&nbsp;<br />
ACID事务控制 表和索引放在一个空间里 表空间多个文件
    </li>
    <li>
        正确使用索引&nbsp;<br />
a. 给合适的列建立索引 where子句 连接子句 而不是select选择列表建立索引&nbsp;<br />
b. 索引值不尽相同 唯一值 索引效果最好 大量重复效果很差&nbsp;<br />
c. 使用短索引 指定前缀长度 较小的索引,索引缓存一定，存的索引多，消耗磁盘IO更小，能提高查找速度&nbsp;<br />
d. 最左前缀 n列索引 最左列的值匹配&nbsp;<br />
e. like查询 索引失效 尽量少用like 千万级数据用like，Sphinx开元方案结合mysql&nbsp;<br />
f. 不能滥用索引&nbsp;<br />
1）索引占用空间&nbsp;<br />
2）更新数据，索引必须更新，时间长 尽量不必要在长期不用的字段上建立索引&nbsp;<br />
3）SQL执行一个查询语句，增加查询优化的时间
    </li>
    <li>
        避免使用SELECT *&nbsp;<br />
a. 返回结果多，降低查询的速度&nbsp;<br />
b. 过多的返回结果,增大服务器返回给APP端的数据传输量.网络传输速度慢,弱网络环境下,容易造成请求实效
    </li>
    <li>
        字段尽量设置为NOT NULL
    </li>
</ol>
<h3 style="font-size:18px;font-family:Helvetica, &quot;">
    五、硬件优化
</h3>
<ol style="font-family:Helvetica, &quot;font-size:15px;">
    <li>
        增加物理内存&nbsp;<br />
Linux内核 内存开缓存 存放数据&nbsp;<br />
-写文件 文件延迟写入机制 先把文件放到缓存 达到一定程度写进硬盘&nbsp;<br />
-读文件 读文件到缓存 下次需要相同文件 从缓存文件中取 没有从硬盘中取
    </li>
    <li>
        增加应用缓存&nbsp;<br />
a. 本地缓存&nbsp;<br />
数据放到服务器内存或文件中&nbsp;<br />
b. 分布式缓存&nbsp;<br />
Redis Memcahce 读写性能非常高 QPS 1W以上 数据持久化 Redis 不持久化 两者都可以
    </li>
    <li>
        SSD代替机械硬盘&nbsp;<br />
a. 日志和数据分开存储 日志顺序读写 机械硬盘 数据随机读写 SSD&nbsp;<br />
b. 调参数 innodb</em>flush<em>method=O</em>DIRECT 操作系统禁用提高缓存 fsync 方式数据刷入机械硬盘&nbsp;<br />
innodb<em>io</em>capacity=10000控制MySQL中一次刷新脏页的数量 SSD io增强 增大一次刷新脏页数量
    </li>
    <li>
        SSD+SATA混合存储FlashCache FaceBook开源在文件系统和设备驱动之间加了一层缓存,对热数据缓存
    </li>
</ol>
<h3 style="font-size:18px;font-family:Helvetica, &quot;">
    六、架构优化
</h3>
<ol style="font-family:Helvetica, &quot;font-size:15px;">
    <li>
        分表&nbsp;<br />
a. 水平拆分&nbsp;<br />
数据分成多个表&nbsp;<br />
b. 垂直拆分&nbsp;<br />
字段分成多个表&nbsp;<br />
c. MyISAM MERGE存储引擎 InnoDB用alter table
    </li>
    <li>
        读写分离&nbsp;<br />
数据库压力大了，读和写拆开，对应主从服务器。主服务器是写操作，从服务器是读操作&nbsp;<br />
大多数业务是读业务，京东淘宝，大量浏览商品，挑选商品。购买是写操作，少量的购买&nbsp;<br />
读服务器写操作的同时，同步从服务器，保持数据完整性，主从复制&nbsp;<br />
主从复制的原理：&nbsp;<br />
基于主服务器的二进制日志(binlog)跟踪所有的对数据库的完整的更改实现&nbsp;<br />
要实现主从复制，必须启动二进制日志在主服务器上&nbsp;<br />
主从复制是异步复制，三个线程参与，主服务器一个线程(IO线程)，从服务器两个(IO线程和SQL线程)&nbsp;<br />
a. 从数据库，执行start slave 开启主从复制&nbsp;<br />
b. 从数据库IO线程会通过主数据库授权的用户请求连接数据库，并请求主数据库的binlog日志的指定位置，change master命令指定日志文件位置&nbsp;<br />
c. 数据库收到IO请求，负责复制的IO线程根据请求&nbsp;<br />
读是一些机器，写是一些机器 二进制文件的主从复制，延迟解决方案
    </li>
    <li>
        分库&nbsp;<br />
Mycat部署 工作流程
    </li>
</ol>
<h3 style="font-size:18px;font-family:Helvetica, &quot;">
    七、SQL慢查询分析 调参数
</h3>
<h3 style="font-size:18px;font-family:Helvetica, &quot;">
    八、活用存储结构
</h3>
<p style="font-size:15px;font-family:Helvetica, &quot;">
    内容表 id user_id content 索引表(字段) 内容表(kv,放数据)
</p>
<h3 style="font-size:18px;font-family:Helvetica, &quot;">
    九、故障排除案例
</h3>
<p style="font-size:15px;font-family:Helvetica, &quot;">
    APP搜索商家，后台数据load居高不下&nbsp;<br />
解决方案:like 查询无索引导致 Sphinx Coreseek开源全文检索
</p></p>
						</td>
					</tr>
				</table>
				
			</article>
			<!-- /Article -->

			<!-- Sidebar -->
			<aside class="col-md-4 sidebar sidebar-right">
				<div class="row panel">
				<div class="col-xs-12">
						<h3>数据结构和算法</h3>
						<p><a href="http://www.mytp.com/classes/66.html">数据结构总览</a></p>					</div><div class="col-xs-12">
						<h3>MySQL</h3>
						<p><a href="http://www.mytp.com/classes/65.html">MySQL优化</a></p>					</div><div class="col-xs-12">
						<h3>日常</h3>
						<p><a href="http://www.mytp.com/classes/68.html">面试技巧和项目分析</a></p><p><a href="http://www.mytp.com/classes/69.html">职业方向划分</a></p><p><a href="http://www.mytp.com/classes/98.html">静态化测试</a></p>					</div><div class="col-xs-12">
						<h3>Linux</h3>
						<p><a href="http://www.mytp.com/classes/59.html">初步了解Linux</a></p>					</div><div class="col-xs-12">
						<h3>Java</h3>
						<p><a href="http://www.mytp.com/classes/67.html">JVM虚拟机</a></p>					</div><div class="col-xs-12">
						<h3>NoSQL</h3>
						<p><a href="http://www.mytp.com/classes/63.html">Redis详解(二)</a></p><p><a href="http://www.mytp.com/classes/64.html">Redis详解(一)</a></p><p><a href="http://www.mytp.com/classes/76.html">mysql优化测试</a></p>					</div>				</div>
			</aside>
			<!-- /Sidebar -->

		</div>

		</section>
	</div>
    
 <footer id="footer">
 
		<div class="container">
   <div class="row">
  <div class="footerbottom">
    <div class="col-md-4 col-sm-6">
      <div class="footerwidget">
        <h4>
          关注我们
        </h4>
        <img class="img-responsive" src="/Public/Uploads/Setting/20170121/588358c437adb.png" style="width: 120px;">
      </div>
    </div>
    <div class="col-md-4 col-sm-6">
      <div class="footerwidget">
        <h4>
          技术服务
        </h4>
        <div class="menu-course">
          <ul class="menu">
            <li> 
              售前小组：9:00-18:00
            </li>
            <li>
              售后小组：9:00-18:00
            </li>
            <li>
              应急小组：24小时×365天
            </li>
            <li>
              应急电话：010-12345678
            </li>
          </ul>
        </div>
      </div>
    </div>
    
    <div class="col-md-4 col-sm-6"> 
            	<div class="footerwidget"> 
                <h4>联系我们</h4> 
                <p>春招集训营</p>
            <div class="contact-info"> 
            QQ：695933122<br/>
            <i class="fa fa-map-marker"></i>&nbsp;&nbsp;北京市朝阳区<br>
            <i class="fa fa-phone"></i>&nbsp;051-6078955<br>
             <i class="fa fa-envelope-o"></i>&nbsp;zqmath@126.com              </div> 
                </div><!-- end widget --> 
    </div>
  </div>
</div>
			<div class="social text-center">
				<a href="#"><i class="fa fa-twitter"></i></a>
				<a href="#"><i class="fa fa-facebook"></i></a>
				<a href="#"><i class="fa fa-dribbble"></i></a>
				<a href="#"><i class="fa fa-flickr"></i></a>
				<a href="#"><i class="fa fa-github"></i></a>
			</div>

			<div class="clear"></div>
			<!--CLEAR FLOATS-->
		</div>
		<div class="footer2">
			<div class="container">
				<div class="row">
					<div class="col-md-12 panel">
						<div class="panel-body">
							<p class="text-center">
								Copyright © 2017. pww版权所有							</p>
						</div>
					</div>

				</div>
				<!-- /row of panels -->
			</div>
		</div>
	</footer>

	<!-- JavaScript libs are placed at the end of the document so the pages load faster -->
	<script src="/Public/assets/js/modernizr-latest.js"></script> 
	<script type='text/javascript' src='/Public/assets/js/jquery.min.js'></script>
    <script type='text/javascript' src='/Public/assets/js/fancybox/jquery.fancybox.pack.js'></script>
    
    <script type='text/javascript' src='/Public/assets/js/jquery.mobile.customized.min.js'></script>
    <script type='text/javascript' src='/Public/assets/js/jquery.easing.1.3.js'></script> 
    <script type='text/javascript' src='/Public/assets/js/camera.min.js'></script> 
    <script src="/Public/assets/js/bootstrap.min.js"></script> 
	<script src="/Public/assets/js/custom.js"></script>
    <script>
		jQuery(function(){
			
			jQuery('#camera_wrap_4').camera({
                transPeriod: 500,
                time: 3000,
				height: '600',
				loader: 'false',
				pagination: true,
				thumbnails: false,
				hover: false,
                playPause: false,
                navigation: false,
				opacityOnGrid: false,
				imagePath: '/Public/assets/images/'
			});

		});
      
	</script>
    
</body>
</html>